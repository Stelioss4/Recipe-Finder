@using Recipe_Finder
@using System.Xml.Serialization
@using System.IO
@inject NavigationManager Navigation


<div class="alert alert-secondary mt-4" style="border: thin solid red; margin: 5px">
    <span class="oi oi-pencil mr-2" aria-hidden="true"></span>

    <EditForm Model="UserProfile" OnSubmit="LogInUser">
        <DataAnnotationsValidator />
        <ValidationSummary />

        <div class="alert alert-secondary mt-4" style="border: thin solid blue; margin: 5px">
            <span class="oi oi-pencil mr-2" aria-hidden="true"></span>
            <label for="FirstName">First Name:</label><br />
            <InputText id="FirstName" @bind-Value="UserProfile.FirstName"></InputText><br />

            <label for="LastName">Last Name:</label><br />
            <InputText id="LastName" @bind-Value="UserProfile.LastName"></InputText><br />

            <label for="Email">Email:</label><br />
            <InputText type="email" id="Email" @bind-Value="UserProfile.Email"></InputText><br />

            <label for="ConfirmEmail">Confirm Email:</label><br />
            <InputText type="email" id="ConfirmEmail" @bind-Value="ConfirmEmail"></InputText><br />

            <label for="Password">Password:</label><br />
            <InputText type="password" id="Password" @bind-Value="UserProfile.Password"></InputText><br />

            <label for="ConfirmPassword">Confirm Password:</label><br />
            <InputText type="password" id="ConfirmPassword" @bind-Value="ConfirmPassword"></InputText><br />
        </div>

        <label for="Address">Address:</label><br />
        <div class="alert alert-secondary mt-4" style="border: thin solid green; margin: 5px">
            <span class="oi oi-pencil mr-2" aria-hidden="true"></span>

            <label for="StreetsName">Street Name:</label><br />
            <InputText id="StreetsName" @bind-Value="UserProfile.Address.StreetsName"></InputText><br />

            <label for="Housenumber">House Number:</label><br />
            <InputText id="Housenumber" @bind-Value="UserProfile.Address.Housenumber"></InputText><br />

            <label for="PostalCode">Postal Code:</label><br />
            <InputText id="PostalCode" @bind-Value="UserProfile.Address.PostalCode"></InputText><br />

            <label for="City">City:</label><br />
            <InputText id="City" @bind-Value="UserProfile.Address.City"></InputText><br /><br />

            <button type="submit" class="btn btn-primary">Register</button>
        </div>

    </EditForm>
</div>

@code {
    [Parameter]
    public string Title { get; set; }

    private UsersProfile UserProfile { get; set; } = new UsersProfile();
    private string ConfirmEmail { get; set; }
    private string ConfirmPassword { get; set; }

    private List<UsersProfile> users { get; set; } = new List<UsersProfile>();

    protected override void OnInitialized()
    {
        users = DataService.LoadUser();
    }

    private void LogInUser()
    {
        var user = users.FirstOrDefault(u => u.Email == UserProfile.Email && u.Password == UserProfile.Password);
        if (user != null)
        {
            Console.WriteLine("User logged in successfully.");
            Navigation.NavigateTo("/profile"); // Redirect to profile page
        }
        else
        {
            Console.WriteLine("Invalid login credentials.");
        }
    }

    private void SaveUser()
    {
        if (UserProfile == null || UserProfile.Email != ConfirmEmail || UserProfile.Password != ConfirmPassword)
        {
            Console.WriteLine("Validation failed. Cannot save user.");
            return;
        }

        users.Add(UserProfile);
        DataService.SaveUser(users);
        Console.WriteLine("User registered successfully.");

        // Clear the input after saving
        UserProfile = new UsersProfile();
        ConfirmEmail = string.Empty;
        ConfirmPassword = string.Empty;
    }
}
