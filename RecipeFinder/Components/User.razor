@using Recipe_Finder
@using System.Xml.Serialization
@using System.IO
@inject DataService userData


<div class="alert alert-secondary mt-4" style="border: thin solid black; margin: 5px">
    <span class="oi oi-pencil mr-2" aria-hidden="true"></span>
    <strong>@Title</strong>

    <span class="text-nowrap">
        <br />
        Please enter your Name:
        <br />
        <input type="text" @bind="UserProfile.Name" />
        <br />
        Please enter your Email:
        <br />
        <input type="text" @bind="UserProfile.Email" />
        <br />
        Please enter your StreetsName:
        <br />
        <input type="text" @bind="Address.StreetsName" />
        <br />
        House number:
        <br />
        <input type="text" @bind="Address.Housenumber" />
        <br />
        Postal code:
        <br />
        <input type="text" @bind="Address.PostalCode" />
        <br />
        City:
        <br />
        <input type="text" @bind="Address.City" />
        <br />

        <button  class="btn btn-primary" @onclick="SaveUser">Save and Continue</button>

    </span>
</div>

@code {
    [Parameter]
    public string Title { get; set; }

    private UsersProfile UserProfile { get; set; } = new UsersProfile();
    private Address Address { get; set; } = new Address();

    private void SaveUser()
    {
        List<UsersProfile> users = DataService.LoadUser(); // Load existing users

        // Check if the user already exists
        bool userExists = users.Any(u => u.Name == UserProfile.Name && u.Email == UserProfile.Email);

        if (!userExists)
        {
            users.Add(UserProfile); // Add the new user

            DataService.SaveUser(users); // Save the updated list of users
            Console.WriteLine("User saved successfully.");
        }
        else
        {
            Console.WriteLine("User already exists."); // Notify that the user already exists
        }
    }
}